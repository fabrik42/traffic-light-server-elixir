* Traffic Light Server

Start server with

#+begin_src sh
iex -S mix phx.server
#+end_src

* Webhook API
Example for a webhook for codeship (the only supported webooks right now):

#+begin_src restclient
POST http://localhost:4000/webhooks/codeship?token=MY-SECRET-CI-TOKEN
Content-Type: application/json

{
  "build": {
    "build_url":"https://www.codeship.com/projects/10213/builds/973711",
    "commit_url":"https://github.com/codeship/docs/ commit/96943dc5269634c211b6fbb18896ecdcbd40a047",
    "project_id":10213,
    "build_id":973711,
    "status":"success",
    "project_full_name":"codeship/docs",
    "project_name":"codeship/docs",
    "commit_id":"96943dc5269634c211b6fbb18896ecdcbd40a047",
    "short_commit_id":"96943",
    "message":"Merge pull request #34 from codeship/feature/shallow-clone",
    "committer":"beanieboi",
    "branch":"master"
  }
}
#+end_src

* Deploy on Heroku
Install the Heroku Redis addon. This will also provide you with the =REDIS_URL= environment variable.

Make sure all other required environment variables have been set.

Open a new iex console on Heroku.

#+begin_src sh
heroku run iex -S mix
#+end_src

Setup some initial data for each mode:

#+begin_src elixir
ls = TrafficLight.LightSetting.build(mode: "ci")
TrafficLight.LightSetting.save(ls, "ci")
ls = TrafficLight.LightSetting.build(mode: "public")
TrafficLight.LightSetting.save(ls, "public")
#+end_src
* Misc Links
- [[https://github.com/fabrik42/traffic-light-server][fabrik42/traffic-light-server: The original server built with node.js]]
- [[https://github.com/fabrik42/traffic-light-client-elixir][fabrik42/traffic-light-client-elixir: A web controlled traffic light for Raspberry PI, powered by Elixir and Nerves]]
* Dependencies
- [[https://github.com/whatyouhide/redix][redix: Fast, pipelined, resilient Redis driver for Elixir]]
- [[https://github.com/devinus/poison][poison: An incredibly fast, pure Elixir JSON library]]
